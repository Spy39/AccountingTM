/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@widgetjs/tree@1.8.3/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import ajax from"./ajax";import"./index.less";function deepClone(e){return JSON.parse(JSON.stringify(e))}function uniq(e){const t={};return e.reduce(((e,s)=>(t[s]||(t[s]=!0,e.push(s)),e)),[])}function empty(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function animation(e,t){requestAnimationFrame((()=>{t.enter(),requestAnimationFrame((()=>{t.active(),setTimeout((()=>{t.leave()}),e)}))}))}export default function Tree(e,t){this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=e,this.options=Object.assign({selectMode:"checkbox",values:[],disables:[],beforeLoad:null,loaded:null,url:null,method:"GET",closeDepth:null},t),Object.defineProperties(this,{values:{get(){return this.getValues()},set(e){return this.setValues(uniq(e))}},disables:{get(){return this.getDisables()},set(e){return this.setDisables(uniq(e))}},selectedNodes:{get(){let e=[],t=this.nodesById;for(let s in t)if(t.hasOwnProperty(s)&&(1===t[s].status||2===t[s].status)){const i=Object.assign({},t[s]);delete i.parent,delete i.children,e.push(i)}return e}},disabledNodes:{get(){let e=[],t=this.nodesById;for(let s in t)if(t.hasOwnProperty(s)&&t[s].disabled){let i=Object.assign({},t[s]);delete i.parent,e.push(i)}return e}}}),this.options.url?this.load((e=>{this.init(e)})):this.init(this.options.data)}Tree.prototype.init=function(e){console.time("init");let{treeNodes:t,nodesById:s,leafNodesById:i,defaultValues:n,defaultDisables:d}=Tree.parseTreeData(e);this.treeNodes=t,this.nodesById=s,this.leafNodesById=i,this.render(this.treeNodes);const{values:o,disables:l,loaded:a}=this.options;o&&o.length&&(n=o),n.length&&this.setValues(n),l&&l.length&&(d=l),d.length&&this.setDisables(d),a&&a.call(this),console.timeEnd("init")},Tree.prototype.load=function(e){console.time("load");const{url:t,method:s,beforeLoad:i}=this.options;ajax({url:t,method:s,success:t=>{let s=t;console.timeEnd("load"),i&&(s=i(t)),e(s)}})},Tree.prototype.render=function(e){const t=Tree.createRootEle();t.appendChild(this.buildTree(e,0)),this.bindEvent(t);const s=document.querySelector(this.container);empty(s),s.appendChild(t)},Tree.prototype.buildTree=function(e,t){const s=Tree.createUlEle();return e&&e.length&&e.forEach((e=>{const i=Tree.createLiEle(e,t===this.options.closeDepth-1);this.liElementsById[e.id]=i;let n=null;e.children&&e.children.length&&(n=this.buildTree(e.children,t+1)),n&&i.appendChild(n),s.appendChild(i)})),s},Tree.prototype.bindEvent=function(e){e.addEventListener("click",(e=>{const{target:t}=e;"SPAN"===t.nodeName&&(t.classList.contains("treejs-checkbox")||t.classList.contains("treejs-label"))?this.onItemClick(t.parentNode.nodeId):"LI"===t.nodeName&&t.classList.contains("treejs-node")?this.onItemClick(t.nodeId):"SPAN"===t.nodeName&&t.classList.contains("treejs-switcher")&&this.onSwitcherClick(t)}),!1)},Tree.prototype.onItemClick=function(e){console.time("onItemClick");const t=this.nodesById[e],{onChange:s}=this.options;t.disabled||(this.setValue(e),this.updateLiElements()),s&&s.call(this),console.timeEnd("onItemClick")},Tree.prototype.setValue=function(e){const t=this.nodesById[e];if(!t)return;const s=t.status,i=1===s||2===s?0:2;t.status=i,this.markWillUpdateNode(t),this.walkUp(t,"status"),this.walkDown(t,"status")},Tree.prototype.getValues=function(){const e=[];for(let t in this.leafNodesById)this.leafNodesById.hasOwnProperty(t)&&(1!==this.leafNodesById[t].status&&2!==this.leafNodesById[t].status||e.push(t));return e},Tree.prototype.setValues=function(e){this.emptyNodesCheckStatus(),e.forEach((e=>{this.setValue(e)})),this.updateLiElements();const{onChange:t}=this.options;t&&t.call(this)},Tree.prototype.setDisable=function(e){const t=this.nodesById[e];if(!t)return;t.disabled||(t.disabled=!0,this.markWillUpdateNode(t),this.walkUp(t,"disabled"),this.walkDown(t,"disabled"))},Tree.prototype.getDisables=function(){const e=[];for(let t in this.leafNodesById)this.leafNodesById.hasOwnProperty(t)&&this.leafNodesById[t].disabled&&e.push(t);return e},Tree.prototype.setDisables=function(e){this.emptyNodesDisable(),e.forEach((e=>{this.setDisable(e)})),this.updateLiElements()},Tree.prototype.emptyNodesCheckStatus=function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach((e=>{e.disabled||(e.status=0)}))},Tree.prototype.emptyNodesDisable=function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach((e=>{e.disabled=!1}))},Tree.prototype.getSelectedNodesById=function(){return Object.entries(this.nodesById).reduce(((e,[t,s])=>(1!==s.status&&2!==s.status||(e[t]=s),e)),{})},Tree.prototype.getDisabledNodesById=function(){return Object.entries(this.nodesById).reduce(((e,[t,s])=>(s.disabled&&(e[t]=s),e)),{})},Tree.prototype.updateLiElements=function(){Object.values(this.willUpdateNodesById).forEach((e=>{this.updateLiElement(e)})),this.willUpdateNodesById={}},Tree.prototype.markWillUpdateNode=function(e){this.willUpdateNodesById[e.id]=e},Tree.prototype.onSwitcherClick=function(e){const t=e.parentNode,s=t.lastChild,i=s.scrollHeight;t.classList.contains("treejs-node__close")?animation(150,{enter(){s.style.height=0,s.style.opacity=0},active(){s.style.height=`${i}px`,s.style.opacity=1},leave(){s.style.height="",s.style.opacity="",t.classList.remove("treejs-node__close")}}):animation(150,{enter(){s.style.height=`${i}px`,s.style.opacity=1},active(){s.style.height=0,s.style.opacity=0},leave(){s.style.height="",s.style.opacity="",t.classList.add("treejs-node__close")}})},Tree.prototype.walkUp=function(e,t){const{parent:s}=e;if(s){if("status"===t){let e=null;const t=s.children.reduce(((e,t)=>isNaN(t.status)?e:e+t.status),0);if(e=t?t===2*s.children.length?2:1:0,s.status===e)return;s.status=e}else{const e=s.children.reduce(((e,t)=>e&&t.disabled),!0);if(s.disabled===e)return;s.disabled=e}this.markWillUpdateNode(s),this.walkUp(s,t)}},Tree.prototype.walkDown=function(e,t){e.children&&e.children.length&&e.children.forEach((s=>{"status"===t&&s.disabled||(s[t]=e[t],this.markWillUpdateNode(s),this.walkDown(s,t))}))},Tree.prototype.updateLiElement=function(e){const{classList:t}=this.liElementsById[e.id];switch(e.status){case 0:t.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:t.remove("treejs-node__checked"),t.add("treejs-node__halfchecked");break;case 2:t.remove("treejs-node__halfchecked"),t.add("treejs-node__checked")}switch(e.disabled){case!0:t.contains("treejs-node__disabled")||t.add("treejs-node__disabled");break;case!1:t.contains("treejs-node__disabled")&&t.remove("treejs-node__disabled")}},Tree.parseTreeData=function(e){const t=deepClone(e),s={},i={},n=[],d=[],o=function(e,t){e.forEach((e=>{s[e.id]=e,e.checked&&n.push(e.id),e.disabled&&d.push(e.id),t&&(e.parent=t),e.children&&e.children.length?o(e.children,e):i[e.id]=e}))};return o(t),{treeNodes:t,nodesById:s,leafNodesById:i,defaultValues:n,defaultDisables:d}},Tree.createRootEle=function(){const e=document.createElement("div");return e.classList.add("treejs"),e},Tree.createUlEle=function(){const e=document.createElement("ul");return e.classList.add("treejs-nodes"),e},Tree.createLiEle=function(e,t){const s=document.createElement("li");if(s.classList.add("treejs-node"),t&&s.classList.add("treejs-node__close"),e.children&&e.children.length){const e=document.createElement("span");e.classList.add("treejs-switcher"),s.appendChild(e)}else s.classList.add("treejs-placeholder");const i=document.createElement("span");i.classList.add("treejs-checkbox"),s.appendChild(i);const n=document.createElement("span");n.classList.add("treejs-label");const d=document.createTextNode(e.text);return n.appendChild(d),s.appendChild(n),s.nodeId=e.id,s};
//# sourceMappingURL=/sm/70c9d7f13842bac1916dd6548c504d28204fafd390925c6ef5d12c197c5c0d4f.map